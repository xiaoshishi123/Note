# AI+BIM智能体调研

# 智能配管APR调研

# 🚀 Automatic Pipe Routing 自动布管流程概述

## 📘 一、优化模型（Optimization Model）

### Step 1: 建模阶段
1. **空间建模（Space modeling）**  
   -  告诉系统“管子能走的地方在哪儿”，比如哪些区域是空的，哪些地方不能走（像墙、梁）。
2. **路径建模（Route modeling）**  
   - 把“管子怎么连”变成一个“路径图”，可能是从设备A连到B，沿着哪些方向走。

### Step 2: 数学建模阶段
3. **目标建模（Objective modeling）**  
   - 设定优化目标，如路径最短、弯头最少、成本最小。
4. **约束建模（Constraint modeling）**  
   - 引入规范与设计限制，如最小净距、管道坡度、空间占用冲突等。

---

## 💡 二、求解算法（Solution Algorithm）

1. **分支策略（Branching）**  
   - 探索可能路径的拓展方法，解决组合爆炸问题。

2. **资源竞争处理（Resource competition）**  
   - 多条管道之间资源（空间/高度/路径）的分配与冲突检测。

3. **空间维度处理（Space dimensionality）**  
   - 三维路径建模与搜索，提高现实布管的空间适应能力。

---

## 🔁 决策变量（Decision Variables）

建模那边会产生一堆“待决定的参数”（比如：从哪个点出发、在哪儿转弯、用多大管子），这些参数交给算法来处理，最终给出布管方案。





## 三，优化模型

空间建模是将问题的目标和约束**以可行方式表达**的第一步。如果要构建一个能表示**所有可能路径**的模型，就需要采用**连续路径表示法**。尽管这种方法在自动配管（APR）中偶尔使用（见第3.1.2节），但大多数APR研究会采用**离散化方法**来简化问题。

这种离散化通常有两种方式：

1. **限制连续变量**只能取一组离散的选项；
2. **完全离散化建模**：将路径空间划分为允许管道通过的特定点，例如用**图结构（graph）**建模。

一个典型示例是**网格图（grid graph）**：

- 每个网格单元可以看作一个图中的**顶点（vertex）**，它与相邻单元之间有**边（edge）**相连；
- 一条管道路径就可以用图中从起点到终点的一条路径来表示（见图4c）；
- 目标函数和约束可以依赖于这些**边和顶点**进行建模；
  - 例如：**最短路径目标** → 用最少的网格单元从起点到终点；
  - 例如：**避障约束** → 不允许路径经过表示障碍物的网格单元。

图4展示了网格图的构建过程：

- 图4a：将连续空间划分为均匀的网格单元；
- 图4b：每个网格单元赋值（如：白=自由空间，绿=管道1，橙=管道2，灰=障碍）；
- 图4c：通过图中的路径表示管道的布线。

![1-1](APRpicture/1-1.PNG)





### 3.1 布线和空间建模

- 为了简化配管建模，很多研究采用“**出租车几何**”——只允许管道按90度角走直线，像走城市街区一样。相比任意角度的欧几里得布线，这种方法更符合实际工程中管道的布局习惯。

- **为什么用这个方法**：
  - 限制急弯，减少压力损失；
  - 管道更容易并行放置、安装方便；
  - 实际工程中非90度布线很少见。

### （1）APR 常见单元分解方法笔记

![1-2](APRpicture/1-2.PNG)

- **图6a｜均匀网格（Uniform Grid）**  
  - 将布线空间划分为等大小的格子；
  - 路径只能上下左右走，实现正交布线；
  - 网格大小通常依据最小管道直径设定；
  - 是使用最广泛的图建模方法之一。

- **图6b｜四叉树（Quadtree）**  
  - 当局部区域细节增多时，递归划分为更小格子；
  - 三维版本称为八叉树（Octree）；
  - 能动态适应障碍物密集区域，提高建模效率。

- **图6c｜非均匀网格（Non-Uniform Grid）**  
  - 从障碍物角点向外绘制水平/垂直线直到边界；
  - 生成不规则网格，更好贴合实际障碍形状；
  - 文献中用于更复杂布线环境的建模。

- **图6d｜梯形分解（Trapezoidal Decomposition）**  
  - 类似 corner stitching 方法；
  - 通过障碍物角点延伸水平或垂直线，把空间分成梯形区域；
  - 用于清晰地划分自由空间与障碍区域。

- **图6e｜德劳内三角剖分（Delaunay Triangulation）**  
  - 将空间划分为一系列三角形；
  - 适用于不规则点集，便于后续构建骨架图或路径图；
  - 结构均衡、连接稳定，适用于复杂布局分析。

- **图6f｜最小凸/正交分解（Minimum Convex/Orthogonal Decomposition）**  
  - 通过最小化单元数量或边长提高建模效率；
  - 虽然目前在APR中未广泛使用，但已有研究关注；
  - 强调空间划分的最优化质量。

### （2）APR常见骨架化方法

![1-3](APRpicture/1-3.PNG)

- **图7a｜Hanan Grid**
  - 从每个障碍物点向四个正交方向（上下左右）延伸线段，直到触碰边界；
  - 基于非均匀网格（图6c）生成；
  - 常用于正交布线环境中，结构规整。

- **图7b｜Visibility Graph（可视图）**
  - 将所有“互相可见”的关键点之间建立连接；
  - 支持任意角度路径，适合带有多边形障碍物的环境；
  - 能够提供理论上的最短路径，但图结构可能很密集。

- **图7c｜Escape Graph（逃逸图）**
  - 与 Hanan Grid 类似，但线段不是画到边界，而是画到**第一个碰到的障碍物**；
  - 生成的图更紧凑，顶点数量更少；
  - 适合拥挤环境下的路径提取。

- **图7d｜Generalized Voronoi Diagram（广义 Voronoi 图）**
  - 为每个障碍物划定最近的自由空间区域；
  - 区域之间的边界线代表“等距离于两个障碍物”的路径线；
  - 常用于生成避障能力强、距离障碍物最远的路径。

---

### ✨ 其他变种与改进方法

- `**Track Graph**（可以考虑测试）`
  - 类似 escape graph，但进一步减少了图中的顶点数量；
  - 提升计算效率，结构更简洁。

- **Manhattan Visibility Graph**
  - 正交版本的可视图，结合 escape graph 思路；
  - 强化 90 度布线规则，同时减少顶点数量。

- **Compressed Visibility Graph**
  - 对可视图进行压缩，减少顶点，提高搜索效率。

- **Random Sampling Skeleton**
  - 通过随机采样确定关键顶点位置；
  - 适用于空间形状复杂、结构不规则的布线环境。

- **Chaos Grid（混沌网格）**
  - 使用 logistic 映射方法对网格点进行扰动，构造出骨架图；
  - 属于较新颖的预处理策略，灵活性强。

---

### 💡单元分解方法---骨架化方法  区别

- 骨架化方法侧重**提取通路骨架**；
- 常与图搜索算法（如 Dijkstra、A\*）结合，用于高效生成布线路径；
- 可与图6中的分解方法互补使用，例如将分解结构转化为骨架图。

##### 🌐 单元分解方法（Cell Decomposition）

- 把空间划分成规则或不规则的“区域单元”；
- 每个区域是图中的一个顶点，路径经过这些区域；
- 路径不精确，只表示“经过哪个区域”；
- 更适合规则环境，如网格、四叉树、梯形分解等；
- 示例：图6a（均匀网格）、图6b（四叉树）等。

##### 🕸️ 骨架化方法（Skeletonization）
- 直接在空间中提取“可行路径骨架”；
- 每个顶点是具体坐标点，边是连接路径；
- 路径精度高，可直接用于最短路径搜索；
- 更适合复杂障碍环境，如可视图、Voronoi图等；
- 示例：图7a（Hanan Grid）、图7b（Visibility Graph）等。

##### ✅ 总结对比

| 对比项     | 单元分解             | 骨架化                   |
| ---------- | -------------------- | ------------------------ |
| 建模方式   | 区域划分             | 路径抽取（线）           |
| 路径粒度   | 粗（区域级）         | 细（点对点）             |
| 表达精度   | 低，需进一步细化     | 高，路径可直接使用       |
| 使用场景   | 空间规则，结构清晰   | 障碍复杂，路径优化需求高 |
| 是否避障   | 间接避障（依靠划分） | 避障路径自动提取         |
| 与搜索关系 | 需要复杂搜索         | 可直接图搜索（如A\*）    |

### （3）连续建模方法（Continuous Modeling） 上面两种是离散的

- 不依赖网格或图结构，直接在连续空间中规划路径；
- 管道路径由两部分组成：直管段 + 弯头；
- 引入两个连续性概念：
  - **Length-continuity**：直管段长度可任意；
  - **Bend-continuity**：弯头角度可任意；
- 图方法是离散的（固定长度、角度），而连续方法精度更高；
- 缺点是计算复杂，不常用于实际APR建模中



### （4）障碍物建模

- **常用方法**：使用正交的最小包围盒（bounding box）简化障碍物形状；
- **处理方式**：
  - 将障碍物按管道半径“膨胀”，路径只需避开中心线；
  - 可叠加多个矩形表示复杂障碍；
  - 有优化方法用多个小盒子更贴近真实轮廓；
- **方法差异**：
  - **离散方法**：障碍越复杂，网格越多 → 推荐用简单包围盒；
  - **连续方法**：可处理复杂障碍，用元启发式算法避障；
- **两大要求**：
  1. 模型简单，计算快；
  2. 尽量贴近实际结构（精度 vs 性能需权衡）。

### （5）分支管道布线建模

放在求解算法中

## 3.2 目标和约束建模

























